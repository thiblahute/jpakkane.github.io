<!DOCTYPE html>
<html lang="en">
<head>

<base href=".">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Unit tests</title>

<link rel="stylesheet" href="assets/css/custom_bootstrap.css" type="text/css">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">

<link rel="stylesheet" href="assets/css/prism.css" type="text/css">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/isotope.pkgd.min.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/trie.js"></script>

<title>The MesonÂ® Build System</title>
<link rel="icon" type="image/png" href="assets/images/favicon.png">
<link rel="shortcut icon" href="assets/images/favicon.png">

</head>

<body class="no-script
" data-spy="scroll" data-target="#toc" data-offset="70">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<form action="" class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/meson_logo.png" alt="Home" id="home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
	<a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		Modules <span class="caret"></span>
	</a>
	<ul class="dropdown-menu" id="modules-menu">
					<li>
				<a href="Gnome-module.html">GNOME</a>
			</li>
					<li>
				<a href="i18n-module.html">i18n</a>
			</li>
					<li>
				<a href="Pkgconfig-module.html">Pkgconfig</a>
			</li>
					<li>
				<a href="Python-3-module.html">Python 3</a>
			</li>
					<li>
				<a href="Qt4-module.html">Qt4</a>
			</li>
					<li>
				<a href="Qt5-module.html">Qt5</a>
			</li>
					<li>
				<a href="RPM-module.html">RPM</a>
			</li>
					<li>
				<a href="Windows-module.html">Windows</a>
			</li>
			</ul>
</li>
<li class="dropdown">
	<a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		Quick References <span class="caret"></span>
	</a>
	<ul class="dropdown-menu" id="quick-refs-menu">
					<li>
				<a href="Reference-manual.html">Functions</a>
			</li>
					<li>
				<a href="Build-options.html">Options</a>
			</li>
					<li>
				<a href="Configuration.html">Configuration</a>
			</li>
					<li>
				<a href="Dependencies.html">Dependencies</a>
			</li>
					<li>
				<a href="Unit-tests.html">Tests</a>
			</li>
					<li>
				<a href="Syntax.html">Syntax</a>
			</li>
			</ul>
</li>
			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
				<p><b>The Meson Build System</b></p>
			</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="core" data-hotdoc-in-toplevel="True" data-hotdoc-project="Meson-documentation-1.0" data-hotdoc-ref="Unit-tests.html" class="page_container" id="page-wrapper">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/navigation.js"></script>
			<script src="assets/js/sitemap.js"></script>
	</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-source="Unit-tests.md" data-hotdoc-role="main">
        <h1 id="unit-tests">Unit tests</h1>
<p>Meson comes with a fully functional unit test system. To use it simply build an executable and then use it in a test.</p>
<pre><code class="language-meson">e = executable('prog', 'testprog.c')
test('name of test', e)
</code></pre>
<p>You can add as many tests as you want. They are run with the command <code>ninja test</code>.</p>
<p>Meson captures the output of all tests and writes it in the log file <code>meson-logs/testlog.txt</code>.</p>
<h2 id="test-parameters">Test parameters</h2>
<p>Some tests require the use of command line arguments or environment variables. These are simple to define.</p>
<pre><code class="language-meson">test('command line test', exe, args : ['first', 'second'])
test('envvar test', exe2, env : ['key1=value1', 'key2=value2'])
</code></pre>
<p>Note how you need to specify multiple values as an array.</p>
<h2 id="coverage">Coverage</h2>
<p>If you enable coverage measurements by giving Meson the command line flag <code>-Db_coverage=true</code>, you can generate coverage reports. Meson will autodetect what coverage generator tools you have installed and will generate the corresponding targets. These targets are <code>coverage-xml</code> and <code>coverage-text</code> which are both provided by <a href="http://gcovr.com">Gcovr</a> and <code>coverage-html</code>, which requires <a href="https://ltp.sourceforge.io/coverage/lcov.php">Lcov</a> and <a href="https://linux.die.net/man/1/genhtml">GenHTML</a>.</p>
<p>The output of these commands is written to the log directory <code>meson-logs</code> in your build directory.</p>
<h2 id="parallelism">Parallelism</h2>
<p>To reduce test times, Meson will by default run multiple unit tests in parallel. It is common to have some tests which can not be run in parallel because they require unique hold on some resource such as a file or a D-Bus name. You have to specify these tests with a keyword argument.</p>
<pre><code class="language-meson">test('unique test', t, is_parallel : false)
</code></pre>
<p>Meson will then make sure that no other unit test is running at the same time. Non-parallel tests take longer to run so it is recommended that you write your unit tests to be parallel executable whenever possible.</p>
<p>By default Meson uses as many concurrent processes as there are cores on the test machine. You can override this with the environment variable <code>MESON_TESTTHREADS</code> like this.</p>
<pre><code class="language-console">$ MESON_TESTTHREADS=5 ninja test
</code></pre>
<h2 id="skipped-tests">Skipped tests</h2>
<p>Sometimes a test can only determine at runtime that it can not be run. The GNU standard approach in this case is to exit the program with error code 77. Meson will detect this and report these tests as skipped rather than failed. This behavior was added in version 0.37.0.</p>
<h2 id="testing-tool">Testing tool</h2>
<p>In version 0.37.0 a new tool called <code>mesontest</code> was added. The goal of this tool is to provide a simple way to run tests in a variety of different ways. The tool is designed to be run in the build directory.</p>
<p>The simplest thing to do is just to run all tests, which is equivalent to running <code>ninja test</code>.</p>
<pre><code class="language-console">$ mesontest
</code></pre>
<p>You can also run only a single test by giving its name:</p>
<pre><code class="language-console">$ mesontest testname
</code></pre>
<p>Sometimes you need to run the tests multiple times, which is done like this:</p>
<pre><code class="language-console">$ mesontest --repeat=10
</code></pre>
<p>Invoking tests via a helper executable such as Valgrind can be done with the <code>--wrap</code> argument</p>
<pre><code class="language-console">$ mesontest --wrap=valgrind testname
</code></pre>
<p>Arguments to the wrapper binary can be given like this:</p>
<pre><code class="language-console">$ mesontest --wrap='valgrind --tool=helgrind' testname
</code></pre>
<p>Meson also supports running the tests under GDB. Just doing this:</p>
<pre><code class="language-console">$ mesontest --gdb testname
</code></pre>
<p>Mesontest will launch <code>gdb</code> all set up to run the test. Just type <code>run</code> in the GDB command prompt to start the program.</p>
<p>The second use case is a test that segfaults only rarely. In this case you can invoke the following command:</p>
<pre><code class="language-console">$ mesontest --gdb --repeat=10000 testname
</code></pre>
<p>This runs the test up to 10 000 times under GDB automatically. If the program crashes, GDB will halt and the user can debug the application. Note that testing timeouts are disabled in this case so mesontest will not kill <code>gdb</code> while the developer is still debugging it. The downside is that if the test binary freezes, the test runner will wait forever.</p>
<p>For further information see the command line help of Mesontest by running <code>mesontest -h</code>.</p>

    </div>
        




		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<hr>
	<div id="footer">
		    
        
<hr>

<div class="license-description">
    Website licensing information are available on the <a href="legal.html">Legal</a> page.
</div>


	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		<a href="https://github.com/mesonbuild/meson//edit/master/docs/markdown/Unit-tests.md" data-hotdoc-role="edit-button">Edit on github</a>

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>

</body>

<script src="assets/js/navbar_offset_scroller.js"></script>
</html>
